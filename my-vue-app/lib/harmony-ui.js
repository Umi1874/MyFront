window.Harmony||(window.Harmony={}),Harmony.UI=window.Harmony.UI={LOADING:"loading",OUTPUT:"output",_fields:[],addField:function(e,n){null!=n&&(Harmony.UI._fields[e]=n.length?n[0]:n)},addressLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.ADDRESS,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n),r={fullAddress:Harmony.UI._getFieldValue(Harmony.ADDRESS)};Harmony.UI._setLoading(Harmony.ADDRESS,!0),Harmony.address(r,o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.fullAddress,n.value=n.fullAddress,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.ADDRESS,!1)})},o.select=function(a,r){if(e.value=r.item.value,o.skipTransaction)Harmony.UI._setFieldValues(r.item);else{var t=Harmony.UI._getSourceOfTruth(n);Harmony.transaction(t,function(){Harmony.UI._setFieldValues(r.item)})}o.onSelect&&o.onSelect(a,r)},Harmony.UI._autocomplete(e,o)}},buildingNameLookup:function(e,n,a){if(Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};Harmony.UI.addField(Harmony.BUILDING_NAME,e),o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.BUILDING_NAME,!0),Harmony.buildingName(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.buildingName+", "+n.streetNumber+" "+n.street+("undefined"!=typeof n.locality?", "+n.locality:"")+("undefined"!=typeof n.suburb?", "+n.suburb:"")+("undefined"!=typeof n.townCity?", "+n.townCity:""),n.value=n.buildingName,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.BUILDING_NAME,!1)})},o.select=function(n,a){e.value=a.item.value,a.item.subdwelling="",Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},floorLevelTypeSelect:function(e,n){var a=Harmony.UI._getSourceOfTruth(n);Harmony.Types.floorLevel(a,function(n){Harmony.UI._populateSelect(e,n)})},localityLookup:function(e,n,a){if(Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};Harmony.UI.addField(Harmony.LOCALITY,e),o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.LOCALITY,!0),Harmony.locality(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.locality+" ("+n.postcode+" "+("undefined"!=typeof n.townCity?n.townCity:n.state)+")",n.value=n.locality,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.LOCALITY,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValue(Harmony.POSTCODE,a.item.postcode)},Harmony.UI._autocomplete(e,o)}},parseAddress:function(){Harmony.UI._setLoading(Harmony.ADDRESS,!0),Harmony.Parse.address(Harmony.UI._getFieldValue(Harmony.ADDRESS),function(e){e.status==Harmony.SUCCESS?null==e.payload[0].exception?(Harmony.UI._clearOutput(),Harmony.UI._setFieldValues(e.payload[0])):(Harmony.UI._clearFieldValues(),Harmony.UI._error(e.payload[0].exception)):Harmony.UI._error(e.message),Harmony.UI._setLoading(Harmony.ADDRESS,!1)})},postalLookup:function(e,n,a){if(Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};Harmony.UI.addField(Harmony.POSTAL,e),o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.POSTAL,!0),Harmony.postal(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.postal,n.value=n.postal,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.POSTAL,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},postalTypeSelect:function(e,n){var a=Harmony.UI._getSourceOfTruth(n);Harmony.Types.postal(a,function(n){Harmony.UI._populateSelect(e,n)})},postcodeLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.POSTCODE,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.POSTCODE,!0),Harmony.postcode(Harmony.UI._getAddress(o),o,function(e){for(var n,o,r=[],t=0;t<e.payload.length;t++)n=e.payload[t],o="undefined"!=typeof n.suburb?n.suburb:"undefined"!=typeof n.locality?n.locality:"",o+=(""!=o?" ":"")+("undefined"!=typeof n.townCity?n.townCity:"undefined"!=typeof n.state?n.state:""),n.label=n.postcode+" ("+o+")",n.value=n.postcode,r[r.length]=n;a(r),Harmony.UI._setLoading(Harmony.POSTCODE,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},setOutputElement:function(e){Harmony.UI.addField(Harmony.UI.OUTPUT,e)},streetLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.STREET,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.STREET,!0),Harmony.street(Harmony.UI._getAddress(o),o,function(e){for(var n=[],o=0;o<e.payload.length;o++){var r=e.payload[o];r.label=r.street+", "+("undefined"!=typeof r.suburb?r.suburb:r.locality),r.value=r.street,n[n.length]=r}a(n),Harmony.UI._setLoading(Harmony.STREET,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},streetNumberLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.STREET_NUMBER,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.STREET_NUMBER,!0),Harmony.streetNumber(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.streetNumber+" "+n.street,n.value=$.trim(n.streetNumber),o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.STREET_NUMBER,!1)})},o.select=function(n,a){e.value=a.item.value,a.item.subdwelling="",Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},streetSuffixTypeSelect:function(e,n){var a=Harmony.UI._getSourceOfTruth(n);Harmony.Types.streetSuffix(a,function(n){Harmony.UI._populateSelect(e,n)})},streetTypeSelect:function(e,n){var a=Harmony.UI._getSourceOfTruth(n);Harmony.Types.street(a,function(n){Harmony.UI._populateSelect(e,n)})},subdwellingLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.SUBDWELLING,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.SUBDWELLING,!0),Harmony.subdwelling(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.fullAddress,n.value=$.trim(n.subdwelling),o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.SUBDWELLING,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},suburbLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.SUBURB,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.SUBURB,!0),Harmony.suburb(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.suburb+", "+n.townCity+" ("+n.postcode+")",n.value=n.suburb,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.SUBURB,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},townCityLookup:function(e,n,a){if(Harmony.UI.addField(Harmony.TOWN_CITY,e),Harmony.UI._checkDependencies()){var o="undefined"!=typeof a?a:{};o.source=function(e,a){var o=Harmony.UI._getSourceOfTruth(n);Harmony.UI._setLoading(Harmony.TOWN_CITY,!0),Harmony.townCity(Harmony.UI._getAddress(o),o,function(e){for(var n,o=[],r=0;r<e.payload.length;r++)n=e.payload[r],n.label=n.townCity+" ("+(""!=n.suburb?n.suburb+", ":"")+n.postcode+")",n.value=n.townCity,o[o.length]=n;a(o),Harmony.UI._setLoading(Harmony.TOWN_CITY,!1)})},o.select=function(n,a){e.value=a.item.value,Harmony.UI._setFieldValues(a.item)},Harmony.UI._autocomplete(e,o)}},unitFlatTypeSelect:function(e,n){var a=Harmony.UI._getSourceOfTruth(n);Harmony.Types.unitFlat(a,function(n){Harmony.UI._populateSelect(e,n)})},identifyAddress:function(){Harmony.UI._setLoading(Harmony.EID,!0),Harmony.Extensions.identify({eid:Harmony.UI._getFieldValue(Harmony.EID)},function(e){null!=e?Harmony.UI._setFieldValues(e.payload[0]):Harmony.UI._error("Failed to identify address"),Harmony.UI._setLoading(Harmony.EID,!1)})},_addSelectOption:function(e,n,a){var o=document.createElement("option");o.text=n,o.value=a,e.add(o)},_autocomplete:function(e,n){window.$(e).autocomplete(n)},_checkDependencies:function(){var e=!0;return window.Harmony||(alert("Harmony JavaScript library is required"),e=!1),window.jQuery||(alert("jQuery is required"),e=!1),"undefined"!=typeof jQuery.autocomplete&&(alert("jQuery UI Autocomplete is required"),e=!1),e},_clearFieldValues:function(){Harmony.UI._setFieldValues({})},_clearOutput:function(){Harmony.UI._error("")},_error:function(e){var n=Harmony.UI._getField(Harmony.UI.OUTPUT);null!=n&&("undefined"!=typeof n.value?n.value=e:$(n).html(e))},_getAddress:function(e){var n=Harmony.UI._getSourceOfTruthCountry(e),a={};return null!=Harmony.UI._getField(Harmony.POSTCODE)&&(a.postcode=Harmony.UI._getFieldValue(Harmony.POSTCODE)),n==Harmony.AUSTRALIA&&null!=Harmony.UI._getField(Harmony.LOCALITY)&&(a.locality=Harmony.UI._getFieldValue(Harmony.LOCALITY)),n==Harmony.NEW_ZEALAND&&null!=Harmony.UI._getField(Harmony.TOWN_CITY)&&(a.townCity=Harmony.UI._getFieldValue(Harmony.TOWN_CITY)),n==Harmony.NEW_ZEALAND&&null!=Harmony.UI._getField(Harmony.SUBURB)&&(a.suburb=Harmony.UI._getFieldValue(Harmony.SUBURB),a.locality=a.suburb),null!=Harmony.UI._getField(Harmony.STREET)&&(a.street=Harmony.UI._getFieldValue(Harmony.STREET)),null!=Harmony.UI._getField(Harmony.STREET_NUMBER)&&(a.streetNumber=Harmony.UI._getFieldValue(Harmony.STREET_NUMBER)),null!=Harmony.UI._getField(Harmony.SUBDWELLING)&&(a.subdwelling=Harmony.UI._getFieldValue(Harmony.SUBDWELLING)),null!=Harmony.UI._getField(Harmony.POSTAL)&&(a.postal=Harmony.UI._getFieldValue(Harmony.POSTAL)),null!=Harmony.UI._getField(Harmony.BUILDING_NAME)&&(a.buildingName=Harmony.UI._getFieldValue(Harmony.BUILDING_NAME)),a},_getField:function(e){return Harmony.UI._fields[e]},_getFieldValue:function(e){var n=$(Harmony.UI._getField(e)),a="";return n.length&&(a=n.val()),a},_getSourceOfTruth:function(e){var n=Harmony.UI._getFieldValue(Harmony.SOURCE_OF_TRUTH);return("undefined"==typeof n||""==n)&&(n=e),n},_getSourceOfTruthCountry:function(e){var n=null;return e==Harmony.AUSOTS||e==Harmony.AUPAF||e==Harmony.GNAF?n=Harmony.AUSTRALIA:e==Harmony.NZPAF&&(n=Harmony.NEW_ZEALAND),n},_populateSelect:function(e,n){var a;if("undefined"!=typeof n&&"undefined"!=typeof n.payload)for(a=0;a<n.payload.length;a++)Harmony.UI._addSelectOption(e,n.payload[a].name,n.payload[a].value);else Harmony.UI._addSelectOption(e,"No data available",0)},_setFieldValue:function(e,n){var a=Harmony.UI._getField(e);null!=a&&(a.value="undefined"!=typeof n?n:"")},_setFieldValues:function(e){var n="";if("undefined"!=typeof e){Harmony.UI._setFieldValue(Harmony.EID,e.eid),Harmony.UI._setFieldValue(Harmony.POSTCODE,e.postcode),Harmony.UI._setFieldValue(Harmony.STATE,e.state),Harmony.UI._setFieldValue(Harmony.LOCALITY,e.locality),Harmony.UI._setFieldValue(Harmony.TOWN_CITY,e.townCity),Harmony.UI._setFieldValue(Harmony.SUBURB,e.suburb),Harmony.UI._setFieldValue(Harmony.STREET,e.street),Harmony.UI._setFieldValue(Harmony.STREET_2,e.street2),Harmony.UI._setFieldValue(Harmony.STREET_NUMBER,e.streetNumber),Harmony.UI._setFieldValue(Harmony.POSTAL,e.postal),Harmony.UI._setFieldValue(Harmony.BUILDING_NAME,e.buildingName),Harmony.UI._setFieldValue(Harmony.SUBDWELLING,e.subdwelling),Harmony.UI._setFieldValue(Harmony.CARE_OF,e.careOf),Harmony.UI._setFieldValue(Harmony.ADDRESS,e.fullAddress),Harmony.UI._setFieldValue(Harmony.ID,e.id),Harmony.UI._setFieldValue(Harmony.FLOOR_LEVEL_TYPE,e.floorLevelType),Harmony.UI._setFieldValue(Harmony.FLOOR_LEVEL_NUMBER,e.floorLevelNumber),Harmony.UI._setFieldValue(Harmony.FLAT_UNIT_TYPE,e.flatUnitType),Harmony.UI._setFieldValue(Harmony.FLAT_UNIT_NUMBER,e.flatUnitNumber),Harmony.UI._setFieldValue(Harmony.LOT_NUMBER,e.lotNumber),Harmony.UI._setFieldValue(Harmony.STREET_NAME,e.streetName),Harmony.UI._setFieldValue(Harmony.STREET_TYPE,e.streetType),Harmony.UI._setFieldValue(Harmony.STREET_SUFFIX,e.streetSuffix);for(var a in e.attributes)n+=(""==n?"":", ")+a+": "+e.attributes[a];Harmony.UI._setFieldValue(Harmony.ATTRIBUTES,n)}},_setLoading:function(e,n){var a=$(Harmony.UI._getField(e));n?a.addClass(Harmony.UI.LOADING):a.removeClass(Harmony.UI.LOADING)}};